{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "company-schema.json",
  "title": "Company Profile Schema",
  "description": "Schema for Danish manufacturing company profiles - self-evolving based on discovered data",
  "type": "object",
  "required": ["id", "name", "source"],
  "properties": {
    "id": {
      "type": "string",
      "description": "Unique identifier (UUID or CVR-based)"
    },
    "cvr": {
      "type": "string",
      "pattern": "^[0-9]{8}$",
      "description": "Danish CVR number (8 digits)"
    },
    "name": {
      "type": "string",
      "description": "Company name"
    },
    "legalName": {
      "type": "string",
      "description": "Official legal name from CVR"
    },
    "description": {
      "type": "string",
      "description": "Company description extracted from website or CVR"
    },
    "address": {
      "type": "object",
      "properties": {
        "street": { "type": "string" },
        "city": { "type": "string" },
        "postalCode": { "type": "string" },
        "country": { "type": "string", "default": "Denmark" },
        "coordinates": {
          "type": "object",
          "properties": {
            "lat": { "type": "number" },
            "lng": { "type": "number" }
          }
        }
      }
    },
    "contact": {
      "type": "object",
      "properties": {
        "phone": { "type": "string" },
        "email": { "type": "string", "format": "email" },
        "website": { "type": "string", "format": "uri" }
      }
    },
    "industry": {
      "type": "object",
      "properties": {
        "naceCode": { "type": "string", "description": "NACE industry code" },
        "naceDescription": { "type": "string" },
        "primaryIndustry": { "type": "string" },
        "subIndustries": { "type": "array", "items": { "type": "string" } }
      }
    },
    "capabilities": {
      "type": "object",
      "description": "Manufacturing capabilities - structure evolves based on discovered data",
      "properties": {
        "processes": {
          "type": "array",
          "items": { "type": "string" },
          "description": "List of manufacturing processes (welding, cutting, etc.)"
        },
        "materials": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Materials the company works with"
        },
        "welding": {
          "type": "object",
          "properties": {
            "types": { "type": "array", "items": { "type": "string" } },
            "maxThickness": { "type": "number", "description": "mm" },
            "minThickness": { "type": "number", "description": "mm" },
            "certifications": { "type": "array", "items": { "type": "string" } }
          }
        },
        "cutting": {
          "type": "object",
          "properties": {
            "types": { "type": "array", "items": { "type": "string" } },
            "maxThickness": { "type": "number", "description": "mm" },
            "bedSize": {
              "type": "object",
              "properties": {
                "width": { "type": "number", "description": "mm" },
                "length": { "type": "number", "description": "mm" }
              }
            }
          }
        },
        "bending": {
          "type": "object",
          "properties": {
            "maxLength": { "type": "number", "description": "mm" },
            "maxThickness": { "type": "number", "description": "mm" },
            "minRadius": { "type": "number", "description": "mm" }
          }
        },
        "machining": {
          "type": "object",
          "properties": {
            "types": { "type": "array", "items": { "type": "string" } },
            "maxLength": { "type": "number", "description": "mm" },
            "maxDiameter": { "type": "number", "description": "mm" },
            "tolerance": { "type": "number", "description": "mm" }
          }
        },
        "pipes": {
          "type": "object",
          "properties": {
            "minDiameter": { "type": "number", "description": "mm" },
            "maxDiameter": { "type": "number", "description": "mm" },
            "maxLength": { "type": "number", "description": "mm" },
            "materials": { "type": "array", "items": { "type": "string" } }
          }
        },
        "surfaceTreatment": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Available surface treatments (painting, galvanizing, etc.)"
        }
      },
      "additionalProperties": true
    },
    "certifications": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Quality certifications (ISO 9001, EN 1090, etc.)"
    },
    "companyInfo": {
      "type": "object",
      "properties": {
        "employees": { "type": "string", "description": "Employee range (e.g., '10-25')" },
        "employeeCount": { "type": "integer" },
        "founded": { "type": "integer" },
        "revenue": { "type": "string" },
        "ownership": { "type": "string" }
      }
    },
    "source": {
      "type": "object",
      "required": ["type"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["cvr", "website", "manual", "ai_extracted"],
          "description": "How this data was obtained"
        },
        "url": { "type": "string", "format": "uri" },
        "extractedAt": { "type": "string", "format": "date-time" },
        "confidence": { "type": "number", "minimum": 0, "maximum": 1 },
        "aiModel": { "type": "string", "description": "Which AI model extracted the data" }
      }
    },
    "metadata": {
      "type": "object",
      "properties": {
        "createdAt": { "type": "string", "format": "date-time" },
        "updatedAt": { "type": "string", "format": "date-time" },
        "verified": { "type": "boolean", "default": false },
        "claimedByOwner": { "type": "boolean", "default": false },
        "searchScore": { "type": "number", "description": "How often this company appears in successful searches" },
        "contactScore": { "type": "number", "description": "How often users contact this company" }
      }
    }
  }
}
